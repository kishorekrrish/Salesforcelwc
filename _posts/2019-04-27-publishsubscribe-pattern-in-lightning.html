---
layout: post
title: Publish–Subscribe Pattern in Lightning Web Components (pubsub)
date: '2019-04-27T04:18:00.001-07:00'
author: Kishore Bandanadam
tags:
- Lightning Web Components
modified_time: '2019-11-01T12:07:49.228-07:00'
thumbnail: https://2.bp.blogspot.com/-ZetreCOxHQs/XMRHxs-G4_I/AAAAAAAAAKM/NLDP8pdOkBU0XXy8ZF4TC2DRTpEtwmY3ACLcBGAs/s72-c/Publish%2BSubscribe.png
blogger_id: tag:blogger.com,1999:blog-1420289748500157217.post-4821362136304092867
blogger_orig_url: https://www.salesforcelwc.in/2019/04/publishsubscribe-pattern-in-lightning.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><a href="https://www.salesforcelwc.in/2019/04/publishsubscribe-pattern-in-lightning.html" rel="">Publish–Subscribe Pattern in Lightning Web Components</a><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-ZetreCOxHQs/XMRHxs-G4_I/AAAAAAAAAKM/NLDP8pdOkBU0XXy8ZF4TC2DRTpEtwmY3ACLcBGAs/s1600/Publish%2BSubscribe.png" style="margin-left: 1em; margin-right: 1em;"><img alt="Publish–Subscribe Pattern in Lightning Web Components" border="0" data-original-height="410" data-original-width="640" src="https://2.bp.blogspot.com/-ZetreCOxHQs/XMRHxs-G4_I/AAAAAAAAAKM/NLDP8pdOkBU0XXy8ZF4TC2DRTpEtwmY3ACLcBGAs/s1600/Publish%2BSubscribe.png" title="Publish–Subscribe Pattern in Lightning Web Components" /></a></div><br /><br /><h3 style="text-align: left;"><a href="https://www.salesforcelwc.in/2019/04/publishsubscribe-pattern-in-lightning.html" rel="">PubSub | Lightning Web Components</a></h3><br />How do components communicate with each other !!<br /><br />To communicate between components that are not in the same DOM tree, we use a singleton library that follows the publish-subscribe pattern.<br /><br /><a name='more'></a><br /><input name="IL_IN_ARTICLE" type="hidden" /><br />In a publish-subscribe pattern, one component publishes an event while the other components subscribe to receive and handle the event. Every component that subscribes to the event receives the event. Let's say, you have two components to a Lightning page in App Builder, then use the pubsub module to send events between them. Pubsub is not given by default, you have to add it to by yourself. You can get the file from here.<br /><div><br /></div><div><div class="small-button"><a class="button small" href="https://gist.github.com/kishoreBandanadam/051952c51a6df85ae342db7b7b443644" rel="nofollow" target="_blank">PubSub file</a> </div><br /><!-- Post Ad --><br /><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><br /><!-- In Article Display Ads --><br /><ins class="adsbygoogle" data-ad-client="ca-pub-6753262254014660" data-ad-slot="9445070986" style="display: inline-block; height: 410px; width: 640px;"></ins><br /><script>     (adsbygoogle = window.adsbygoogle || []).push({}); </script><br /><!-- Post Ad --><br /><h2 style="text-align: left;">pubSub.js</h2><pre class="language-javascript" width="100%"><code><br />/**<br /> * A basic pub-sub mechanism for sibling component communication<br /> *<br /> * TODO - adopt standard flexipage sibling communication mechanism when it's available.<br /> */<br /><br />const events = {};<br /><br />const samePageRef = (pageRef1, pageRef2) =&gt; {<br />    const obj1 = pageRef1.attributes;<br />    const obj2 = pageRef2.attributes;<br />    return Object.keys(obj1)<br />        .concat(Object.keys(obj2))<br />        .every(key =&gt; {<br />            return obj1[key] === obj2[key];<br />        });<br />};<br /><br />/**<br /> * Registers a callback for an event<br /> * @param {string} eventName - Name of the event to listen for.<br /> * @param {function} callback - Function to invoke when said event is fired.<br /> * @param {object} thisArg - The value to be passed as the this parameter to the callback function is bound.<br /> */<br />const registerListener = (eventName, callback, thisArg) =&gt; {<br />    // Checking that the listener has a pageRef property. We rely on that property for filtering purpose in fireEvent()<br />    if (!thisArg.pageRef) {<br />        throw new Error(<br />            'pubsub listeners need a "@wire(CurrentPageReference) pageRef" property'<br />        );<br />    }<br /><br />    if (!events[eventName]) {<br />        events[eventName] = [];<br />    }<br />    const duplicate = events[eventName].find(listener =&gt; {<br />        return listener.callback === callback &amp;&amp; listener.thisArg === thisArg;<br />    });<br />    if (!duplicate) {<br />        events[eventName].push({ callback, thisArg });<br />    }<br />};<br /><br />/**<br /> * Unregisters a callback for an event<br /> * @param {string} eventName - Name of the event to unregister from.<br /> * @param {function} callback - Function to unregister.<br /> * @param {object} thisArg - The value to be passed as the this parameter to the callback function is bound.<br /> */<br />const unregisterListener = (eventName, callback, thisArg) =&gt; {<br />    if (events[eventName]) {<br />        events[eventName] = events[eventName].filter(<br />            listener =&gt;<br />                listener.callback !== callback || listener.thisArg !== thisArg<br />        );<br />    }<br />};<br /><br />/**<br /> * Unregisters all event listeners bound to an object.<br /> * @param {object} thisArg - All the callbacks bound to this object will be removed.<br /> */<br />const unregisterAllListeners = thisArg =&gt; {<br />    Object.keys(events).forEach(eventName =&gt; {<br />        events[eventName] = events[eventName].filter(<br />            listener =&gt; listener.thisArg !== thisArg<br />        );<br />    });<br />};<br /><br />/**<br /> * Fires an event to listeners.<br /> * @param {object} pageRef - Reference of the page that represents the event scope.<br /> * @param {string} eventName - Name of the event to fire.<br /> * @param {*} payload - Payload of the event to fire.<br /> */<br />const fireEvent = (pageRef, eventName, payload) =&gt; {<br />    if (events[eventName]) {<br />        const listeners = events[eventName];<br />        listeners.forEach(listener =&gt; {<br />            if (samePageRef(pageRef, listener.thisArg.pageRef)) {<br />                try {<br />                    listener.callback.call(listener.thisArg, payload);<br />                } catch (error) {<br />                    // fail silently<br />                }<br />            }<br />        });<br />    }<br />};<br /><br />export {<br />    registerListener,<br />    unregisterListener,<br />    unregisterAllListeners,<br />    fireEvent<br />};<br /></code></pre></div></div><br /><h3 style="text-align: left;">Fire an event:</h3><div>To fire an even using Publish–Subscribe Pattern. In the js file of the component from where you want to fire the event, import the two lines shown below</div><div><pre class="language-javascript" width="100%"><code><br />import{CurrentPageReference}<br />      from 'lightning/navigation';<br />import { fireEvent } <br />       from 'c/pubsub';<br /></code></pre></div><br />Whenever the required condition is met then use the following code to fire the even.<br /><pre class="language-javascript" width="100%"><code><br />fireEvent(this.pageRef,<br />     'restaurantListUpdate',<br />       this.message);<br /></code></pre><br /><div><blockquote class="tr_bq"><b>fireEvent({<i>pageReference</i>}, {<i>eventName</i>}, {<i>data</i>})</b></blockquote><!-- Post Ad --><br /><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><br /><!-- Common Display Ad --><br /><ins class="adsbygoogle"      style="display:block"      data-ad-client="ca-pub-6753262254014660"      data-ad-slot="8811166651"      data-ad-format="auto"      data-full-width-responsive="true"></ins><br /><script>     (adsbygoogle = window.adsbygoogle || []).push({}); </script><br /><!-- Post Ad --><br /><h3 style="text-align: left;">Subscribe and Receive the Event:</h3></div><div>In the component where you want to subscribe and receive event, import the following,</div><div><pre class="language-javascript" width="100%"><code><br />import{CurrentPageReference} <br />   from 'lightning/navigation';<br />import { registerListener,<br />   unregisterAllListeners } <br />   from 'c/pubsub';<br /><br />connectedCallback() {<br />registerListener('restaurantListUpdate' <br />             ,this.handleRestaurants, <br />             this);<br />}<br /><br />disconnectedCallback() {<br />   unregisterAllListeners(this);<br />}<br /></code></pre></div><br /><br />In connectedCallback we subscribe to the event, In disconnectedCallback we un-subscribe.<br /><br />Hope this post helped you gain some knowledge, If you like the content please don't step back to like my page and leave your feedback, It will motivate me to make more posts.<br /><br />Subscribe to get the latest updates directly in your inbox.<br /><br /><!-- Post Ad --><br /><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><br /><!-- In Article Display Ads --><br /><ins class="adsbygoogle" data-ad-client="ca-pub-6753262254014660" data-ad-slot="9445070986" style="display: inline-block; height: 410px; width: 640px;"></ins><br /><script>     (adsbygoogle = window.adsbygoogle || []).push({}); </script><br /><!-- Post Ad --></div><div class="blogger-post-footer">kishore
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block; text-align:center;"
     data-ad-layout="in-article"
     data-ad-format="fluid"
     data-ad-client="ca-pub-6753262254014660"
     data-ad-slot="4346718206"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div>